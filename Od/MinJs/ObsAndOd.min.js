var Obs,Od;(function(n){var l=!1,u,c,r;n.defaultEq=function(n,t){return n===t};n.valueOfEq=function(n,t){return n&&t&&n.valueOf()===t.valueOf()||!n&&!t};n.alwaysUpdate=function(){return!1};n.of=function(t,i){i===void 0&&(i=null);i=i||n.defaultEq;var r=null;return r=function(n){return o(r,i,n,arguments.length)},r.obsid=e++,r.value=t,r.toString=u,r};n.fn=function(t,i){i===void 0&&(i=n.defaultEq);var r=null;return r=function(n){return o(r,i,n,arguments.length)},r.obsid=e++,r.fn=function(){return a(r,t,i)},r.dependencies={},r.toString=u,s(r),r};n.peek=function(n){return n.value};n.isObservable=function(n){return n&&n.obsid&&n instanceof Function};n.isComputed=function(n){return!!n.fn};n.subscribe=function(n,t){for(var f,h=function(){var n=i;i=null;t();i=n},r=h,c=e++,o=n,s=0;s<o.length;s++)f=o[s],f.dependents||(f.dependents={}),f.dependents[c]=r;return r.obsid=c,r.fn=h,r.value="{subscription}",r.toString=u,r.subscriptions=o,r.level=999999999,r};n.value=function(t){return n.isObservable(t)?t():t};n.toStringMaxValueLength=32;u=function(){var t=JSON.stringify(this.value);return t&&n.toStringMaxValueLength<t.length&&(t=t.substr(0,n.toStringMaxValueLength)+"..."),"{obs "+(this.id||"")+" = "+t+"}"};n.dispose=function(n){var t=n,f,i,r,e,u;if(t.value=null,h(t),t.dependents={},f=t.obsid,i=t.subscriptions,i){for(r=0;r<i.length;r++)(e=i[r],u=e.dependents,u)&&(u[f]=null);t.subscriptions=null}};var o=function(t,u,f,e){if(e){if(t.fn)throw new Error("Computed observables cannot be assigned to.");r("Updating obs",t.obsid);var o=t.value;t.value=f;u(o,f)||n.updateDependents(t)}else i&&(i[t.obsid]=t);return t.value},a=function(n,t,i){var u=n.value,r=t();return n.value=r,!i(u,r)},e=1,t=[],v=function(n){var i,u,e,f,o;if(!n.isInUpdateQueue){for(r("  Enqueueing obs",n.obsid),i=t.length,t.push(n),n.isInUpdateQueue=!0,u=i>>1,e=n.level;i;){if(f=t[u],o=f.level,o<=e)break;t[i]=f;i=u;u=i>>1}t[i]=n;r("    UpdateQ =",JSON.stringify(t.map(function(n){return n.obsid})))}},y=function(){var u,n,i;if(!t.length)return undefined;u=t[0];u.isInUpdateQueue=!1;r("  Dequeueing obs",u.obsid);var e=t.pop(),o=e.level,f=t.length;if(!f)return u;for(n=0,i=1;i<f;){var s=Math.min(i+1,f-1),h=t[i],c=t[s],l=h.level,a=c.level;if(l<=a){if(o<=l)break;t[n]=h;n=i}else{if(o<=a)break;t[n]=c;n=s}i=n<<1}return t[n]=e,u},f=0;n.startUpdate=function(){f++};n.endUpdate=function(){f&&f--;f===0&&p()};var p=function(){for(;;){var n=y();if(!n)return;s(n)}},i=null,s=function(t){var u,f;r("Reevaluating obs",t.obsid,"...");u=i;i=t.dependencies;h(t);f=c(t);w(t);i=u;f&&n.updateDependents(t);r("Reevaluating obs",t.obsid,"done.")},h=function(n){var u=n.obsid,t=n.dependencies,i,r;if(t)for(i in t)(r=t[i],r)&&(t[i]=null,r.dependents[u]=null)},w=function(n){var f=n.obsid,e=n.dependencies,i=0,o,t,u;for(o in e)(t=e[o],t)&&(t.dependents||(t.dependents={}),t.dependents[f]=n,r("  Obs",f,"depends on obs",t.obsid),u=t.level|0,i<=u&&(i=1+u));n.level=i};n.updateDependents=function(t){var i=t.dependents,u,r;if(i){n.startUpdate();for(u in i)(r=i[u],r)&&v(r);n.endUpdate()}};n.exceptionReporter=function(n){return window.console&&window.console.log?window.console.log(n):alert("Exception reevaluating computed observable:\n"+JSON.stringify(n))};c=function(t){try{return t.fn()}catch(i){return n.exceptionReporter(i),!1}};r=function(){l&&window.console&&window.console.log&&console.log.apply(console,arguments)}})(Obs||(Obs={})),function(n){n.flattenVdoms=function(n){var t,i;if(n==null)return null;if(!(n instanceof Array))return[n];var r=n,f=r.length,u=!1;for(t=0;t<f;t++)if(r[t]instanceof Array){u=!0;break}return u?(i=[],v(n,i),i):n};var v=function(n,t){for(var i,u=n.length,r=0;r<u;r++)i=n[r],i instanceof Array?v(i,t):t.push(i)},rt=function(n,t,u){var f=n==null?null:n.toString(),e;return t==null||t.nodeName!=="#text"||r(t)?(e=document.createTextNode(f),i(e,t,u),e):(t.nodeValue!==f&&(t.nodeValue=f),t)},u=function(n,t,i){return n instanceof Function?n(t,i):rt(n,t,i)};n.element=function(u,f,o){u=u.toUpperCase();var c=n.flattenVdoms(o),s=function(n,t){var o=n,e=n==null||o.tagName!==u||r(n)?document.createElement(u):o;return i(e,n,t),vt(e,f),dt(e,c),ut(f,e,n),e},h=f&&f.key;return h!=null&&(s.key=h),e(f)!=null&&t!=null&&(t.hasOdEventHandlers=!0),s};var e=function(n){return n&&n.onodevent},ut=function(n,t,i){var r=e(n);if(r!=null){if(t!==i){o.push(t);return}s.push(t)}},i=function(n,t,i){n!==t&&(nt(t),i!=null)&&(n==null?t!=null&&i.removeChild(t):t==null?i.appendChild(n):i.replaceChild(n,t))},r=function(n){return!!ft(n)},ft=function(n){return n.__Od__componentID},f=function(n,t){n.__Od__componentID=t},y=function(n){f(n,0)},et=function(n){return n.__Od__isAttached},p=function(n,t){n.__Od__isAttached=t},ei=function(n){p(n,!1)},ot=1,t=null,st=function(n){return n!=null&&t!=null?t.namedSubcomponents[n]:null};n.deferComponentUpdates=!0;n.component=function(r,e,o){var v=st(r),c,l,p;if(v!=null)return v;var y=ot++,s={name:r,componentID:y,dom:null,obs:null,subs:null,anonymousSubcomponents:[],namedSubcomponents:{},hasOdEventHandlers:!1,updateIsPending:!1,ondispose:o},h=function(n,t){var r=s.dom,u;return i(r,n,t),r!==n&&s.hasOdEventHandlers&&(u=fi(r),it(r,u)),r};return t!=null&&(r==null?t.anonymousSubcomponents.push(h):t.namedSubcomponents[r]=h),c=Obs.fn(function(){var i=t,n;return t=s,b(s),n=e(),t=i,n}),l=u(Obs.peek(c),null,null),f(l,y),a(),p=Obs.subscribe([c],function(){n.deferComponentUpdates?lt(s):(w(s),a())}),h.dispose=function(){ht(s)},s.dom=l,s.obs=c,s.subs=p,h.key=l.key,h};var w=function(n){var e=t,r;t=n;var o=n.componentID,i=n.dom,s=n.obs,h=i&&i.parentNode;y(i);r=u(s(),i,h);f(r,o);n.dom=r;n.updateIsPending=!1;t=e},ht=function(n){b(n);ct(n);Obs.dispose(n.subs);Obs.dispose(n.obs);var t=n.dom,i=t&&t.remove;i!=null&&i.call(t);y(t);nt(t)},b=function(t){for(var r=t.anonymousSubcomponents,i=r.pop();i!=null;i=r.pop())n.dispose(i)},ct=function(t){var i=t.namedSubcomponents,r,u;for(r in i)u=i[r],n.dispose(u),i[r]=null};n.dispose=function(n){var t=n&&n.dispose;t!=null&&t()};var k=[],h=0,lt=function(n){n.updateIsPending||(n.updateIsPending=!0,k.push(n),h===0)&&(h=ti(at))},at=function(){for(var t=k,n=t.pop();n!=null;n=t.pop())w(n);a();h=0};n.fromHtml=function(n){var t=document.createElement("DIV"),r;return t.innerHTML=n,r=t.childNodes.length===1?t.firstChild:t,f(r,Infinity),function(n,t){return i(r,n,t),r}};n.fromDom=function(n){f(n,Infinity);return function(t,r){return i(n,t,r),n}};n.bind=function(n,t){var i=t&&t.parentNode;return u(n,t,i)};n.appendChild=function(n,t){return u(n,null,t)};var oi=function(n){return n instanceof Array},vt=function(n,t){var r=d(n),i,u,f,e,o;if(t)for(i in t)i!=="style"&&kt(n,i,t[i]);if(r)for(i in r)t&&i in t||bt(n,i);u=r&&r.style;f=t&&t.style;yt(n,u,f);e=r&&r.attrs;o=t&&t.attrs;pt(n,e,o);wt(n,t)},yt=function(n,t,i){var u,r;if(typeof i=="string"){n.style=i;return}if(!i){t&&n.removeAttribute("style");return}u=n.style;for(r in i)u[r]=i[r];if(t)for(r in t)r in i||(u[r]=null)},pt=function(n,t,i){var r;if(i)for(r in i)n.setAttribute(r,i[r]);if(t)for(r in t)i&&r in i||n.removeAttribute(r)},d=function(n){return n.__Od__props},wt=function(n,t){n.__Od__props=t},bt=function(n,t){n[t]=null;n instanceof HTMLElement&&n.removeAttribute(t)},kt=function(n,t,i){t==="class"&&(t="className");n[t]=i},dt=function(n,t){var r,e,f,o,s,h;for(t==null&&(t=[]),n.keyed&&gt(t,n),r=n.firstChild,e=t.length,f=0;f<e;f++)o=t[f],s=u(o,r,n),r=s.nextSibling;while(r)h=r.nextSibling,i(null,r,n),r=h},gt=function(n,t){var e=t.firstChild,h=n.length,o,s,i,u,c,f,l,r;if(h!==0&&e){for(o={},i=e;i;i=i.nextSibling){if(s=i.key,s==null)return;o[s]=i}for(i=e,u=0;u<h;u++){if(c=n[u],f=c.key,f==null)return;l=i&&i.key;r=o[f];i?l===f?i=i.nextSibling:r?t.insertBefore(r,i):t.insertBefore(document.createElement("DIV"),i):r?t.appendChild(r):t.appendChild(document.createElement("DIV"))}}},ni=function(n){return setTimeout(n,16)},ti=window.requestAnimationFrame||ni,g=[],nt=function(n){n&&(r(n)||(g.push(n),c===0)&&(c=setTimeout(ii,0)))},c=0,ii=function(){for(var t=g,n=t.pop();n!=null;n=t.pop())tt(n);c=0},tt=function(n){var i,u,f,o,s,h,t;if(n!=null&&!r(n)){i=d(n);u=e(i);u&&u("removed",n);f=n;for(o in i)(o!=="src"||f.tagName!=="IMG")&&(f[o]=null);for(s=n.childNodes,h=s.length,t=0;t<h;t++)tt(s[t])}},l=!1,o=[],s=[],a=function(){l||(l=!0,ri(),ui(),l=!1)},ri=function(){for(var t,i,n=0;n<o.length;n++)t=o[n],i=t.onodevent,i!=null&&i("created",t);o=[]},ui=function(){for(var t,i,n=0;n<s.length;n++)t=s[n],i=t.onodevent,i!=null&&i("updated",t);s=[]},fi=function(n){for(var i=document.body,t;n!=null;n=n.parentNode){if(n===i)return!0;if(r(n)&&(t=et(n),t!=null))return t}return!1},it=function(n,t){for(var u,i;n!=null;)it(n.firstChild,t),u=n.nextSibling,r(n)&&p(n,t),i=e(n),t&&i!=null&&i("attached",n),n=u}}(Od||(Od={}));