var Obs,Od;(function(n){var l=!1,u,o,i;n.defaultEq=function(n,t){return n===t};n.valueOfEq=function(n,t){return n&&t&&n.valueOf()===t.valueOf()||!n&&!t};n.alwaysUpdate=function(){return!1};n.of=function(t,i){i===void 0&&(i=null);i=i||n.defaultEq;var r=null;return r=function(n){return s(r,i,n,arguments.length)},r.obsid=e++,r.value=t,r.toString=u,r};n.fn=function(t,i){i===void 0&&(i=n.defaultEq);var r=null;return r=function(n){return s(r,i,n,arguments.length)},r.obsid=e++,r.fn=function(){return a(r,t,i)},r.dependencies={},r.toString=u,h(r),r};n.peek=function(n){return n.value};n.isObservable=function(n){return n&&n.obsid&&n instanceof Function};n.isComputed=function(n){return!!n.fn};n.subscribe=function(n,t){for(var f,h=function(){var n=r;r=null;t();r=n},i=h,c=e++,o=n,s=0;s<o.length;s++)f=o[s],f.dependents||(f.dependents={}),f.dependents[c]=i;return i.obsid=c,i.fn=h,i.value="{subscription}",i.toString=u,i.subscriptions=o,i.level=999999999,i};n.value=function(t){return n.isObservable(t)?t():t};n.toStringMaxValueLength=32;u=function(){var t=JSON.stringify(this.value);return t&&n.toStringMaxValueLength<t.length&&(t=t.substr(0,n.toStringMaxValueLength)+"..."),"{obs "+(this.id||"")+" = "+t+"}"};n.dispose=function(n){var t=n,f,i,r,e,u;if(t.value=null,c(t),t.dependents={},f=t.obsid,i=t.subscriptions,i){for(r=0;r<i.length;r++)(e=i[r],u=e.dependents,u)&&(u[f]=null);t.subscriptions=null}};var s=function(t,u,f,e){if(e){if(t.fn)throw new Error("Computed observables cannot be assigned to.");i("Updating obs",t.obsid);var o=t.value;t.value=f;u(o,f)||n.updateDependents(t)}else r&&(r[t.obsid]=t);return t.value},a=function(n,t,i){var u=n.value,r=t();return n.value=r,!i(u,r)},e=1,t=[],v=function(n){var r,u,e,f,o;if(!n.isInUpdateQueue){for(i("  Enqueueing obs",n.obsid),r=t.length,t.push(n),n.isInUpdateQueue=!0,u=r>>1,e=n.level;r;){if(f=t[u],o=f.level,o<=e)break;t[r]=f;r=u;u=r>>1}t[r]=n;i("    UpdateQ =",JSON.stringify(t.map(function(n){return n.obsid})))}},y=function(){var u,n,r;if(!t.length)return undefined;u=t[0];u.isInUpdateQueue=!1;i("  Dequeueing obs",u.obsid);var e=t.pop(),o=e.level,f=t.length;if(!f)return u;for(n=0,r=1;r<f;){var s=Math.min(r+1,f-1),h=t[r],c=t[s],l=h.level,a=c.level;if(l<=a){if(o<=l)break;t[n]=h;n=r}else{if(o<=a)break;t[n]=c;n=s}r=n<<1}return t[n]=e,u},f=0;n.startUpdate=function(){f++};n.endUpdate=function(){f&&f--;f===0&&p()};var p=function(){for(;;){var n=y();if(!n)return;h(n)}},r=null,h=function(t){var u,f;i("Reevaluating obs",t.obsid,"...");u=r;r=t.dependencies;c(t);f=o(t);w(t);r=u;f&&n.updateDependents(t);i("Reevaluating obs",t.obsid,"done.")},c=function(n){var u=n.obsid,t=n.dependencies,i,r;if(t)for(i in t)(r=t[i],r)&&(t[i]=null,r.dependents[u]=null)},w=function(n){var f=n.obsid,e=n.dependencies,r=0,o,t,u;for(o in e)(t=e[o],t)&&(t.dependents||(t.dependents={}),t.dependents[f]=n,i("  Obs",f,"depends on obs",t.obsid),u=t.level|0,r<=u&&(r=1+u));n.level=r};n.updateDependents=function(t){var i=t.dependents,u,r;if(i){n.startUpdate();for(u in i)(r=i[u],r)&&v(r);n.endUpdate()}};n.exceptionReporter=function(n){return window.console&&window.console.log?window.console.log(n):alert("Exception reevaluating computed observable:\n"+JSON.stringify(n))};o=function(t){try{return t.fn()}catch(i){return n.exceptionReporter(i),!1}};i=function(){l&&window.console&&window.console.log&&console.log.apply(console,arguments)}})(Obs||(Obs={})),function(n){n.flattenVdoms=function(n){var t,i;if(n==null)return null;if(!(n instanceof Array))return[n];var r=n,f=r.length,u=!1;for(t=0;t<f;t++)if(r[t]instanceof Array){u=!0;break}return u?(i=[],w(n,i),i):n};var w=function(n,t){for(var i,u=n.length,r=0;r<u;r++)i=n[r],i instanceof Array?w(i,t):t.push(i)},ft=function(n,t,i){var u=n==null?null:n.toString(),f;return t==null||t.nodeName!=="#text"||b(t)?(f=document.createTextNode(u),r(f,t,i),f):(t.nodeValue!==u&&(t.nodeValue=u),t)},u=function(n,t,i){return n instanceof Function?n(t,i):ft(n,t,i)};n.element=function(i,u,f){i=i.toUpperCase();var h=n.flattenVdoms(f),o=function(n,t){var e=n,f=n==null||e.tagName!==i||b(n)?document.createElement(i):e;return r(f,n,t),vt(f,u),dt(f,h),et(u,f,n),f},s=u&&u.key;return s!=null&&(o.key=s),e(u)!=null&&t!=null&&(t.hasOdEventHandlers=!0),o};var e=function(n){return n&&n.onodevent},et=function(n,t,i){var r=e(n);if(r!=null){if(t!==i){s.push(t);return}h.push(t)}},r=function(n,t,r){var u;if(n!==t&&(rt(t),r!=null))if(n==null){if(t==null)return;r.removeChild(t);u=i(t);f(u,!1)}else t==null?r.appendChild(n):(r.replaceChild(n,t),u=i(t),f(u,!1))},b=function(n){return i(n)!=null},i=function(n){return n.__Od__componentInfo},o=function(n,t){i(n)==null&&(n.__Od__componentInfo=t)},k=function(n){n.__Od__componentInfo=null},ot=1,t=null,st=function(n){return n!=null&&t!=null?t.namedSubcomponents[n]:null};n.deferComponentUpdates=!0;n.component=function(e,s){var v=st(e),a,c,w;if(v!=null)return v;var b=ot++,h={name:e,componentID:b,dom:null,isAttached:!1,obs:null,subs:null,anonymousSubcomponents:[],namedSubcomponents:{},hasOdEventHandlers:!1,updateIsPending:!1},l=function(n,i){var u=h.dom,e;return r(u,n,i),u!==n&&h.hasOdEventHandlers&&(e=t!=null?t.isAttached:p(u),f(h,e)),u};if(t!=null&&(e==null?t.anonymousSubcomponents.push(l):t.namedSubcomponents[e]=l),a=Obs.fn(function(){var i=t,n;return t=h,g(h),n=s(),t=i,n}),c=u(Obs.peek(a),null,null),i(c)!=null)throw new Error("Od components must have distinct root DOM nodes.");return o(c,h),y(),w=Obs.subscribe([a],function(){n.deferComponentUpdates?lt(h):(d(h),y())}),l.dispose=function(){ht(h)},h.dom=c,h.obs=a,h.subs=w,l.key=c.key,l};var d=function(n){var f=t,r;t=n;var h=n.componentID,i=n.dom,e=n.obs,s=i&&i.parentNode;k(i);r=u(e(),i,s);o(r,n);n.dom=r;n.updateIsPending=!1;t=f},ht=function(n){g(n);ct(n);Obs.dispose(n.subs);Obs.dispose(n.obs);var t=n.dom,i=t&&t.remove;k(t);rt(t)},g=function(t){for(var r=t.anonymousSubcomponents,i=r.pop();i!=null;i=r.pop())n.dispose(i)},ct=function(t){var i=t.namedSubcomponents,r,u;for(r in i)u=i[r],n.dispose(u),i[r]=null};n.dispose=function(n){var t=n&&n.dispose;t!=null&&t()};var nt=[],l=0,lt=function(n){n.updateIsPending||(n.updateIsPending=!0,nt.push(n),l===0)&&(l=ti(at))},at=function(){for(var t=nt,n=t.pop();n!=null;n=t.pop())d(n);y();l=0};n.fromHtml=function(n){var t=document.createElement("DIV"),i;return t.innerHTML=n,i=t.childNodes.length===1?t.firstChild:t,o(i,{}),function(n,t){return r(i,n,t),i}};n.fromDom=function(n){return o(n,{}),function(t,i){return r(n,t,i),n}};n.bind=function(n,t){var r=t&&t.parentNode,i=u(n,t,r),f=p(t);return c(i,f),i};n.appendChild=function(n,t){var i=u(n,null,t),r=p(t);return c(i,r),i};var fi=function(n){return n instanceof Array},vt=function(n,t){var r=tt(n),i,u,f,e,o;if(t)for(i in t)i!=="style"&&kt(n,i,t[i]);if(r)for(i in r)t&&i in t||bt(n,i);u=r&&r.style;f=t&&t.style;yt(n,u,f);e=r&&r.attrs;o=t&&t.attrs;pt(n,e,o);wt(n,t)},yt=function(n,t,i){var u,r;if(typeof i=="string"){n.style=i;return}if(!i){t&&n.removeAttribute("style");return}u=n.style;for(r in i)u[r]=i[r];if(t)for(r in t)r in i||(u[r]=null)},pt=function(n,t,i){var r;if(i)for(r in i)n.setAttribute(r,i[r]);if(t)for(r in t)i&&r in i||n.removeAttribute(r)},tt=function(n){return n.__Od__props},wt=function(n,t){n.__Od__props=t},bt=function(n,t){n[t]=null;n instanceof HTMLElement&&n.removeAttribute(t)},kt=function(n,t,i){t==="class"&&(t="className");n[t]=i},dt=function(n,t){var i,e,f,o,s,h;for(t==null&&(t=[]),n.keyed&&gt(t,n),i=n.firstChild,e=t.length,f=0;f<e;f++)o=t[f],s=u(o,i,n),i=s.nextSibling;while(i)h=i.nextSibling,r(null,i,n),i=h},gt=function(n,t){var e=t.firstChild,h=n.length,o,s,i,u,c,f,l,r;if(h!==0&&e){for(o={},i=e;i;i=i.nextSibling){if(s=i.key,s==null)return;o[s]=i}for(i=e,u=0;u<h;u++){if(c=n[u],f=c.key,f==null)return;l=i&&i.key;r=o[f];i?l===f?i=i.nextSibling:r?t.insertBefore(r,i):t.insertBefore(document.createElement("DIV"),i):r?t.appendChild(r):t.appendChild(document.createElement("DIV"))}}},ni=function(n){return setTimeout(n,16)},ti=window.requestAnimationFrame||ni,it=[],rt=function(n){if(n){var t=i(n);if(t!=null){f(t,!1);return}(it.push(n),a===0)&&(a=setTimeout(ii,0))}},a=0,ii=function(){for(var t=it,n=t.pop();n!=null;n=t.pop())ut(n);a=0},ut=function(n){var r,u,o,s,h,c,l,t;if(n!=null){if(r=i(n),r!=null){f(r,!1);return}u=tt(n);o=e(u);o&&o("removed",n);s=n;for(h in u)(h!=="src"||s.tagName!=="IMG")&&(s[h]=null);for(c=n.childNodes,l=c.length,t=0;t<l;t++)ut(c[t])}},v=!1,s=[],h=[],y=function(){v||(v=!0,ri(),ui(),v=!1)},ri=function(){for(var n,t,i=0;i<s.length;i++)n=s[i],t=n.onodevent,t!=null&&t("created",n);s=[]},ui=function(){for(var n,t,i=0;i<h.length;i++)n=h[i],t=n.onodevent,t!=null&&t("updated",n);h=[]},p=function(n){for(var r=document.body,t;n!=null;n=n.parentNode){if(n===r)return!0;if(t=i(n),t!=null)return t.isAttached}return!1},f=function(n,t){n!=null&&n.isAttached!=t&&c(n.dom,t)},c=function(n,t){for(var o=t?"attached":"detached",f,r,u;n!=null;)c(n.firstChild,t),f=n.nextSibling,r=i(n),r!=null&&(r.isAttached=t),u=e(n),u!=null&&u(o,n),n=f}}(Od||(Od={}));